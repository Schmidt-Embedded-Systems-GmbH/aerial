\documentclass{article}


\usepackage{pgfplots}
\usepackage{pgfplotstable}
%\pgfplotsset{compat=1.12}
\pgfdeclarelayer{edgelayer}
\pgfdeclarelayer{nodelayer}
\usepgfplotslibrary{fillbetween}

\usepackage{tikz}
\usepackage{tkz-euclide}	
\usetikzlibrary{decorations.markings,fit,shapes.misc}
\usetikzlibrary{arrows, shapes.geometric,snakes}
\usetikzlibrary{patterns,snakes}
\usepgfplotslibrary{external}
\tikzexternalize[prefix=figures/]

\pgfplotsset{
    discard if/.style 2 args={
        x filter/.append code={
            \edef\tempa{\thisrow{#1}}
            \edef\tempb{#2}
            \ifx\tempa\tempb
                \def\pgfmathresult{inf}
            \fi
        }
    },
    discard if not/.style 2 args={
        x filter/.append code={
            \edef\tempa{\thisrow{#1}}
            \edef\tempb{#2}
            \ifx\tempa\tempb
            \else
                \def\pgfmathresult{inf}
            \fi
        }
    }
}


\newcommand{\plotHeight}{18cm}
\newcommand{\plotWidth}{18cm}
\newcommand{\csvfile}{results-avg.csv}


\begin{document}


\foreach\f in{1,2,3,4}{
\begin{figure}

\begin{tikzpicture}[scale=0.65]
    \begin{axis}[
      legend pos=north west,
      legend style={font=\tiny},
      xlabel={Rate (\# events/s)},
      ylabel={Time (ms)},
      height=\plotHeight,
      width=\plotWidth,
      xlabel near ticks,
      ylabel near ticks,
      ymode=log
    ]



\foreach\g in{aerial_MTL_naive, aerial_MTL_local, aerial_MTL_global, aerial_MDL_naive, aerial_MDL_local, aerial_MDL_global, monpoly, montre}{
   \addplot table [discard if not={Formula}{\f}, discard if not={Tool}{\g}, x=Rate, y=Time, col sep=comma] {\csvfile};
}

\legend{Aerial MTL (naive), Aerial MTL (local), Aerial MTL (global), Aerial MDL (naive), Aerial MDL (local), Aerial MDL (global), Monpoly, Montre}
    \end{axis}
\end{tikzpicture}

\caption{Formula \f}
\end{figure}
}


\foreach\f in{1,2,3,4}{
\begin{figure}

\begin{tikzpicture}[scale=0.65]
    \begin{axis}[
      legend pos=north west,
      legend style={font=\tiny},
      xlabel={Rate (\# events/s)},
      ylabel={Memory (MB)},
      height=\plotHeight,
      width=\plotWidth,
      xlabel near ticks,
      ylabel near ticks,
      ymode=log
    ]



\foreach\g in{aerial_MTL_naive, aerial_MTL_local, aerial_MTL_global, aerial_MDL_naive, aerial_MDL_local, aerial_MDL_global, monpoly, montre}{
   \addplot table [discard if not={Formula}{\f}, discard if not={Tool}{\g}, x=Rate, y=Space, col sep=comma] {\csvfile};
}

\legend{Aerial MTL (naive), Aerial MTL (local), Aerial MTL (global), Aerial MDL (naive), Aerial MDL (local), Aerial MDL (global), Monpoly, Montre}
    \end{axis}
\end{tikzpicture}

\caption{Formula \f}
\end{figure}
}


\end{document}
